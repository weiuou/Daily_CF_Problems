**提示 1：** 典型的树上 DP 问题。你需要维护什么状态？

这很明显是一个树上的 DP 问题，需要维护什么状态呢？

对于 $u$ 结点对应的子树，真正影响子树内数值的是对这个点的操作数量，因此设进行加一操作 $f[u]$ 次，减一操作 $g[u]$ 次。

如果 $u$ 的子节点 $v$ 需要进行 $f[v],g[v]$ 次加一 / 减一操作，则这些操作一定也作用在了 $u$ 这个节点上，因为 $u$ 在 $v$ 到 $1$ 的路径上。因此对应的，有 $f[u]\geq f[v], g[u]\geq g[v]$ 。

所以，我们先令 $f[u]=\max(f[v]), g[u]=\max(g[v])$ 。

此时，查看 $u$ 这个结点数值跟目标数值可能有一定差距，此时再把需要增加的操作，增加到 $f[u]$ 或者 $g[u]$ 上即可。

时间复杂度为 $\mathcal{O}(n)$ 。

### 具体代码如下——

Python 做法如下——

```Python []
def main():
    n = II()
    path = [[] for _ in range(n)]
    
    for _ in range(n - 1):
        u, v = GMI()
        path[u].append(v)
        path[v].append(u)
    
    nums = LII()
    
    parent = [-1] * n
    q = [0]
    
    for u in q:
        for v in path[u]:
            if parent[u] != v:
                parent[v] = u
                q.append(v)
    
    f = [0] * n
    g = [0] * n
    
    for u in reversed(q):
        for v in path[u]:
            if parent[v] == u:
                f[u] = fmax(f[u], f[v])
                g[u] = fmax(g[u], g[v])
        
        k = nums[u] + f[u] - g[u]
        if k > 0: g[u] += k
        else: f[u] += -k
    
    print(f[0] + g[0])
```

C++ 做法如下——

```cpp []
int main() {
    ios_base::sync_with_stdio(false);
    cin.tie(0);
    cout.tie(0);
 
    int n;
    cin >> n;
 
    vector<vector<int>> path(n);
    for (int i = 0; i < n - 1; i ++) {
        int u, v;
        cin >> u >> v;
        u --, v --;
        path[u].emplace_back(v);
        path[v].emplace_back(u);
    }
 
    vector<int> nums(n);
    for (auto &v: nums) cin >> v;
 
    vector<long long> f(n, 0), g(n, 0);
 
    auto dfs = [&] (auto &self, int u, int p) -> void {
        for (auto &v: path[u])
            if (v != p) self(self, v, u);
        
        for (auto &v: path[u]) {
            if (v != p) {
                f[u] = max(f[u], f[v]);
                g[u] = max(g[u], g[v]);
            }
        }
 
        long long k = nums[u] + f[u] - g[u];
        if (k > 0) g[u] += k;
        else f[u] -= k;
    };
 
    dfs(dfs, 0, -1);
 
    cout << f[0] + g[0];
 
    return 0;
}
```