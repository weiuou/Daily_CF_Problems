**提示 1：** 数组中的数有哪些可能的形式？

**提示 2：** $x+y=z$ 可以怎么凑？

首先，如果一个数有至少两个不同的质因子 $p,q$ ，那么其自身有 $1,p,q,pq$ 作为因子，数量大于题中给出的 $3$ 。

因此，数组中的每个数至多只有一个质因子。设为 $p^k$ ，则其因子 $1,p,\dots,p^k$ 共计 $k+1$ 个，所以 $k+1\leq 3$ ， $k\leq 2$ 。

于是数组中只能有质数或者质数的平方或 $1$ 。

而考虑大于 $4$ 的这样的数，就只能是奇数了。奇数只能拆成一个奇数和一个偶数的和。

而满足性质的偶数只有 $2$ 和 $4$ ，所以枚举配对的是 $2$ 还是 $4$ 就好。

对于不超过 $4$ 的数拆分成两个数的方案，可以直接暴力走一遍。

下面代码没有按照上面的说法来，稍微讨论的多了点。

时间复杂度为 $\mathcal{O}(n)$ 。

### 具体代码如下——

Python 做法如下——

```Python []
def main():
    n = II()
    nums = LII()
    
    rnd = random.getrandbits(30)
    cnt = Counter(x + rnd for x in nums)
    
    c1 = cnt[1 + rnd]
    c2 = cnt[2 + rnd]
    c4 = cnt[4 + rnd]
    
    ans = c1 * (c1 - 1) * c2
    
    for x in cnt:
        v = x - rnd
        c = cnt[x]
        
        if v <= 2: continue
        
        if v == 3:
            ans += c1 * c2 * c * 2
        
        elif v == 4:
            ans += c2 * (c2 - 1) * c
            if x - 1 in cnt: ans += c1 * cnt[x - 1] * c * 2
        
        else:
            if x - 1 in cnt: ans += c1 * cnt[x - 1] * c * 2
            if x - 2 in cnt: ans += c2 * cnt[x - 2] * c * 2
            if v >= 7 and x - 4 in cnt: ans += c4 * cnt[x - 4] * c * 2
    
    print(ans)
```

C++ 做法如下——

```cpp []
int main() {
    ios_base::sync_with_stdio(false);
    cin.tie(0);
    cout.tie(0);

    int n;
    cin >> n;

    map<long long, int> mp;
    while (n --) {
        long long x;
        cin >> x;
        mp[x] ++;
    }

    int c1 = mp[1], c2 = mp[2], c4 = mp[4];

    long long ans = 1ll * c1 * (c1 - 1) * c2;

    for (auto &[k, v]: mp) {
        if (k <= 2) continue;

        if (k == 3) ans += 2ll * v * c1 * c2;
        else if (k == 4) {
            ans += 1ll * v * c2 * (c2 - 1);
            if (mp.find(3) != mp.end()) ans += 2ll * v * c1 * mp[3];
        }
        else {
            if (mp.find(k - 1) != mp.end()) ans += 2ll * v * c1 * mp[k - 1];
            if (mp.find(k - 2) != mp.end()) ans += 2ll * v * c2 * mp[k - 2];
            if (k >= 7 && mp.find(k - 4) != mp.end()) ans += 2ll * v * c4 * mp[k - 4];
        }
    }

    cout << ans;

    return 0;
}
```